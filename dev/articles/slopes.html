<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="marginaleffects">
<title>Slopes • marginaleffects</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Slopes">
<meta property="og:description" content="marginaleffects">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">marginaleffects</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.9.0.9045</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/marginaleffects.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/vincentarelbundock/marginaleffects/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Slopes</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/vincentarelbundock/marginaleffects/blob/HEAD/vignettes/slopes.Rmd" class="external-link"><code>vignettes/slopes.Rmd</code></a></small>
      <div class="d-none name"><code>slopes.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="definition">Definition<a class="anchor" aria-label="anchor" href="#definition"></a>
</h2>
<p>Slopes are defined as:</p>
<blockquote>
<p>Partial derivatives of the regression equation with respect to a
regressor of interest. a.k.a. Marginal effects, trends.</p>
</blockquote>
<p>This vignette follows the econometrics tradition by referring to
“slopes” and “marginal effects” interchangeably. In this context, the
word “marginal” refers to the idea of a “small change,” in the calculus
sense.</p>
<p>A marginal effect measures the association between a change in a
regressor <span class="math inline">\(x\)</span>, and a change in the
response <span class="math inline">\(y\)</span>. Put differently,
differently, the marginal effect is the slope of the prediction
function, measured at a specific value of the regressor <span class="math inline">\(x\)</span>.</p>
<p>Marginal effects are extremely useful, because they are intuitive and
easy to interpret. They are often the main quantity of interest in an
empirical analysis.</p>
<p>In scientific practice, the “Marginal Effect” falls in the same
toolbox as the <a href="https://vincentarelbundock.github.io/marginaleffects/articles/comparisons.html">“Contrast.”</a>
Both try to answer a counterfactual question: What would happen to <span class="math inline">\(y\)</span> if <span class="math inline">\(x\)</span> were different? They allow us to model
the “effect” of a change/difference in the regressor <span class="math inline">\(x\)</span> on the response <span class="math inline">\(y\)</span>.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;The term “effect” is itself tricky. To be clear, this
vignette does &lt;em&gt;not&lt;/em&gt; use the word “effect” to imply “causality”.&lt;/p&gt;"><sup>1</sup></a></p>
<p>To illustrate the concept, consider this quadratic function:</p>
<p><span class="math display">\[y = -x^2\]</span></p>
<p>From the definition above, we know that the marginal effect is the
partial derivative of <span class="math inline">\(y\)</span> with
respect to <span class="math inline">\(x\)</span>:</p>
<p><span class="math display">\[\frac{\partial y}{\partial x} =
-2x\]</span></p>
<p>To get intuition about how to interpret this quantity, consider the
response of <span class="math inline">\(y\)</span> to <span class="math inline">\(x\)</span>. It looks like this:</p>
<p><img src="slopes_files/figure-html/unnamed-chunk-2-1.png" width="576"></p>
<p>When <span class="math inline">\(x\)</span> increases, <span class="math inline">\(y\)</span> starts to increase. But then, as <span class="math inline">\(x\)</span> increases further, <span class="math inline">\(y\)</span> creeps back down in negative
territory.</p>
<p>A marginal effect is the slope of this response function at a certain
value of <span class="math inline">\(x\)</span>. The next plot adds
three tangent lines, highlighting the slopes of the response function
for three values of <span class="math inline">\(x\)</span>. The slopes
of these tangents tell us three things:</p>
<ol style="list-style-type: decimal">
<li>When <span class="math inline">\(x&lt;0\)</span>, the slope is
positive: an increase in <span class="math inline">\(x\)</span> is
associated with an increase in <span class="math inline">\(y\)</span>:
The marginal effect is positive.</li>
<li>When <span class="math inline">\(x=0\)</span>, the slope is null: a
(small) change in <span class="math inline">\(x\)</span> is associated
with no change in <span class="math inline">\(y\)</span>. The marginal
effect is null.</li>
<li>When <span class="math inline">\(x&gt;0\)</span>, the slope is
negative: an increase in <span class="math inline">\(x\)</span> is
associated with a decrease in <span class="math inline">\(y\)</span>.
The marginal effect is negative.</li>
</ol>
<p><img src="slopes_files/figure-html/unnamed-chunk-3-1.png" width="576"></p>
<p>Below, we show how to reach the same conclusions in an estimation
context, with simulated data and the <code>slopes</code> function.</p>
</div>
<div class="section level2">
<h2 id="slopes-function">
<code>slopes</code> function<a class="anchor" aria-label="anchor" href="#slopes-function"></a>
</h2>
<p>The marginal effect is a <em>unit-level</em> measure of association
between changes in a regressor and changes in the response. Except in
the simplest linear models, the value of the marginal effect will be
different from individual to individual, because it will depend on the
values of the other covariates for each individual.</p>
<p>The <code>slopes</code> function thus produces distinct estimates of
the marginal effect for each row of the data used to fit the model. The
output of <code>marginaleffects</code> is a simple
<code>data.frame</code>, which can be inspected with all the usual
<code>R</code> commands.</p>
<p>To show this, we load the library, download the <a href="https://allisonhorst.github.io/palmerpenguins/" class="external-link">Palmer
Penguins</a> data from the <a href="https://vincentarelbundock.github.io/Rdatasets/articles/data.html" class="external-link"><code>Rdatasets</code>
archive</a>, and estimate a GLM model:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://vincentarelbundock.github.io/marginaleffects/">marginaleffects</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"https://vincentarelbundock.github.io/Rdatasets/csv/palmerpenguins/penguins.csv"</span><span class="op">)</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">large_penguin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">body_mass_g</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">large_penguin</span> <span class="op">~</span> <span class="va">bill_length_mm</span> <span class="op">+</span> <span class="va">flipper_length_mm</span> <span class="op">+</span> <span class="va">species</span>,</span>
<span>           data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mfx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slopes.html">slopes</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mfx</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            Term Contrast Estimate Std. Error     z   Pr(&gt;|z|)    2.5 %  97.5 %</span></span>
<span><span class="co">#&gt;  bill_length_mm    dY/dX  0.01763   0.007841 2.248 0.02455115 0.002262 0.03300</span></span>
<span><span class="co">#&gt;  bill_length_mm    dY/dX  0.03586   0.011923 3.008 0.00263339 0.012491 0.05923</span></span>
<span><span class="co">#&gt;  bill_length_mm    dY/dX  0.08444   0.021123 3.998 6.3953e-05 0.043044 0.12584</span></span>
<span><span class="co">#&gt;  bill_length_mm    dY/dX  0.03473   0.006509 5.336 9.5279e-08 0.021970 0.04748</span></span>
<span><span class="co">#&gt;  bill_length_mm    dY/dX  0.05089   0.013414 3.794 0.00014838 0.024599 0.07718</span></span>
<span><span class="co">#&gt;  bill_length_mm    dY/dX  0.01652   0.007257 2.276 0.02284980 0.002293 0.03074</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, type, term, contrast, estimate, std.error, statistic, p.value, conf.low, conf.high, predicted, predicted_hi, predicted_lo, large_penguin, bill_length_mm, flipper_length_mm, species, eps</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-marginal-effects-zoo">The Marginal Effects Zoo<a class="anchor" aria-label="anchor" href="#the-marginal-effects-zoo"></a>
</h2>
<p>A dataset with one marginal effect estimate per unit of observation
is a bit unwieldy and difficult to interpret. There are ways to make
this information easier to digest, by computing various quantities of
interest. <a href="https://www.andrewheiss.com/blog/2022/05/20/marginalia/" class="external-link">In a
characteristically excellent blog post,</a> Professor Andrew Heiss
introduces many such quantities:</p>
<ul>
<li>Average Marginal Effects</li>
<li>Group-Average Marginal Effects</li>
<li>Marginal Effects at User-Specified Values (or Representative
Values)</li>
<li>Marginal Effects at the Mean</li>
<li>Counterfactual Marginal Effects</li>
<li>Conditional Marginal Effects</li>
</ul>
<p>The rest of this vignette defines each of those quantities and
explains how to use the <code><a href="../reference/slopes.html">slopes()</a></code> and
<code><a href="../reference/plot_slopes.html">plot_slopes()</a></code> functions to compute them. The main
differences between these quantities pertain to (a) the regressor values
at which we estimate marginal effects, and (b) the way in which
unit-level marginal effects are aggregated.</p>
<p>Heiss drew this exceedingly helpful graph which summarizes the
information in the rest of this vignette:</p>
<p><img src="https://user-images.githubusercontent.com/987057/169581274-f0d2beb6-0146-453e-91ca-a320c6ef7144.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="average-marginal-effect-ame">Average Marginal Effect (AME)<a class="anchor" aria-label="anchor" href="#average-marginal-effect-ame"></a>
</h2>
<p>A dataset with one marginal effect estimate per unit of observation
is a bit unwieldy and difficult to interpret. Many analysts like to
report the “Average Marginal Effect”, that is, the average of all the
observation-specific marginal effects. These are easy to compute based
on the full <code>data.frame</code> shown above, but the
<code><a href="../reference/slopes.html">avg_slopes()</a></code> function is convenient:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/slopes.html">avg_slopes</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;               Term           Contrast Estimate Std. Error       z   Pr(&gt;|z|)     2.5 %   97.5 %</span></span>
<span><span class="co">#&gt;     bill_length_mm              dY/dX  0.02757   0.005784  4.7675 1.8653e-06  0.016238  0.03891</span></span>
<span><span class="co">#&gt;  flipper_length_mm              dY/dX  0.01058   0.002357  4.4895 7.1390e-06  0.005963  0.01520</span></span>
<span><span class="co">#&gt;            species Chinstrap - Adelie -0.41479   0.056900 -7.2898 3.1032e-13 -0.526312 -0.30327</span></span>
<span><span class="co">#&gt;            species    Gentoo - Adelie  0.06170   0.106856  0.5774    0.56367 -0.147735  0.27113</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: type, term, contrast, estimate, std.error, statistic, p.value, conf.low, conf.high</span></span></code></pre></div>
<p>Note that since marginal effects are derivatives, they are only
properly defined for continuous numeric variables. When the model also
includes categorical regressors, the <code>summary</code> function will
try to display relevant (regression-adjusted) contrasts between
different categories, as shown above.</p>
<p>You can also extract average marginal effects using <code>tidy</code>
and <code>glance</code> methods which conform to the <a href="https://broom.tidymodels.org/" class="external-link"><code>broom</code> package
specification</a>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">mfx</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 9</span></span></span>
<span><span class="co">#&gt;   type     term              contrast                       estimate std.error statistic  p.value conf.low conf.high</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> response bill_length_mm    mean(dY/dX)                      0.027<span style="text-decoration: underline;">6</span>   0.005<span style="text-decoration: underline;">78</span>     4.77  1.87<span style="color: #949494;">e</span><span style="color: #BB0000;">- 6</span>  0.016<span style="text-decoration: underline;">2</span>     0.038<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> response flipper_length_mm mean(dY/dX)                      0.010<span style="text-decoration: underline;">6</span>   0.002<span style="text-decoration: underline;">36</span>     4.49  7.14<span style="color: #949494;">e</span><span style="color: #BB0000;">- 6</span>  0.005<span style="text-decoration: underline;">96</span>    0.015<span style="text-decoration: underline;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> response species           mean(Chinstrap) - mean(Adelie)  -<span style="color: #BB0000;">0.415</span>    0.056<span style="text-decoration: underline;">9</span>     -<span style="color: #BB0000;">7.29</span>  3.10<span style="color: #949494;">e</span><span style="color: #BB0000;">-13</span> -<span style="color: #BB0000;">0.526</span>     -<span style="color: #BB0000;">0.303</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> response species           mean(Gentoo) - mean(Adelie)      0.061<span style="text-decoration: underline;">7</span>   0.107       0.577 5.64<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span> -<span style="color: #BB0000;">0.148</span>      0.271</span></span>
<span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/glance.html" class="external-link">glance</a></span><span class="op">(</span><span class="va">mfx</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 7</span></span></span>
<span><span class="co">#&gt;     aic   bic r2.tjur  rmse  nobs     F logLik   </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;logLik&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  180.  199.   0.695 0.276   342  15.7 -84.92257</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="group-average-marginal-effect-g-ame">Group-Average Marginal Effect (G-AME)<a class="anchor" aria-label="anchor" href="#group-average-marginal-effect-g-ame"></a>
</h2>
<p>We can also use the <code>by</code> argument the average marginal
effects <em>within different subgroups</em> of the observed data, based
on values of the regressors. For example, to compute the average
marginal effects of Bill Length for each Species, we do:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/slopes.html">avg_slopes</a></span><span class="op">(</span></span>
<span>  <span class="va">mod</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"species"</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"bill_length_mm"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            Term    Contrast   species Estimate Std. Error     z   Pr(&gt;|z|)     2.5 %  97.5 %</span></span>
<span><span class="co">#&gt;  bill_length_mm mean(dY/dX)    Adelie 0.043540   0.008828 4.932 8.1365e-07  0.026237 0.06084</span></span>
<span><span class="co">#&gt;  bill_length_mm mean(dY/dX) Chinstrap 0.036801   0.009801 3.755 0.00017337  0.017592 0.05601</span></span>
<span><span class="co">#&gt;  bill_length_mm mean(dY/dX)    Gentoo 0.002872   0.002846 1.009 0.31299360 -0.002707 0.00845</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: type, term, contrast, species, estimate, std.error, statistic, p.value, conf.low, conf.high, predicted, predicted_hi, predicted_lo</span></span></code></pre></div>
<p>This is equivalent to manually taking the mean of the
observation-level marginal effect for each species sub-group:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span></span>
<span>  <span class="va">mfx</span><span class="op">$</span><span class="va">estimate</span>,</span>
<span>  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">mfx</span><span class="op">$</span><span class="va">species</span>, <span class="va">mfx</span><span class="op">$</span><span class="va">term</span><span class="op">)</span>,</span>
<span>  FUN <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Group.1           Group.2            x</span></span>
<span><span class="co">#&gt; 1    Adelie    bill_length_mm  0.043539914</span></span>
<span><span class="co">#&gt; 2 Chinstrap    bill_length_mm  0.036801185</span></span>
<span><span class="co">#&gt; 3    Gentoo    bill_length_mm  0.002871562</span></span>
<span><span class="co">#&gt; 4    Adelie flipper_length_mm  0.016710631</span></span>
<span><span class="co">#&gt; 5 Chinstrap flipper_length_mm  0.014124217</span></span>
<span><span class="co">#&gt; 6    Gentoo flipper_length_mm  0.001102231</span></span>
<span><span class="co">#&gt; 7    Adelie           species -0.054519623</span></span>
<span><span class="co">#&gt; 8 Chinstrap           species -0.313337522</span></span>
<span><span class="co">#&gt; 9    Gentoo           species -0.250726004</span></span></code></pre></div>
<p>Note that <code>marginaleffects</code> follows <code>Stata</code> and
the <code>margins</code> package in computing standard errors using the
group-wise averaged Jacobian.</p>
</div>
<div class="section level2">
<h2 id="marginal-effect-at-user-specified-values">Marginal Effect at User-Specified Values<a class="anchor" aria-label="anchor" href="#marginal-effect-at-user-specified-values"></a>
</h2>
<p>Sometimes, we are not interested in <em>all</em> the unit-specific
marginal effects, but would rather look at the estimated marginal
effects for certain “typical” individuals, or for user-specified values
of the regressors. The <code>datagrid</code> function helps us build a
data grid full of “typical” rows. For example, to generate artificial
Adelies and Gentoos with 180mm flippers:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>flipper_length_mm <span class="op">=</span> <span class="fl">180</span>,</span>
<span>         species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Adelie"</span>, <span class="st">"Gentoo"</span><span class="op">)</span>,</span>
<span>         model <span class="op">=</span> <span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt;   large_penguin bill_length_mm flipper_length_mm species</span></span>
<span><span class="co">#&gt; 1     0.4853801       43.92193               180  Adelie</span></span>
<span><span class="co">#&gt; 2     0.4853801       43.92193               180  Gentoo</span></span></code></pre></div>
<p>The same command can be used (omitting the <code>model</code>
argument) to <code>marginaleffects</code>’s <code>newdata</code>
argument to compute marginal effects for those (fictional)
individuals:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/slopes.html">slopes</a></span><span class="op">(</span></span>
<span>  <span class="va">mod</span>,</span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span></span>
<span>    flipper_length_mm <span class="op">=</span> <span class="fl">180</span>,</span>
<span>    species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Adelie"</span>, <span class="st">"Gentoo"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;               Term           Contrast Estimate Std. Error       z   Pr(&gt;|z|)     2.5 %    97.5 % bill_length_mm flipper_length_mm species</span></span>
<span><span class="co">#&gt;     bill_length_mm              dY/dX  0.06069   0.033264  1.8245 0.06807114 -0.004505  0.125889       43.92193               180  Adelie</span></span>
<span><span class="co">#&gt;     bill_length_mm              dY/dX  0.08467   0.040400  2.0959 0.03609126  0.005492  0.163856       43.92193               180  Gentoo</span></span>
<span><span class="co">#&gt;  flipper_length_mm              dY/dX  0.02329   0.005498  4.2367 2.2685e-05  0.012517  0.034069       43.92193               180  Adelie</span></span>
<span><span class="co">#&gt;  flipper_length_mm              dY/dX  0.03250   0.008610  3.7745 0.00016034  0.015623  0.049373       43.92193               180  Gentoo</span></span>
<span><span class="co">#&gt;            species Chinstrap - Adelie -0.21105   0.103178 -2.0455 0.04080661 -0.413276 -0.008824       43.92193               180  Adelie</span></span>
<span><span class="co">#&gt;            species Chinstrap - Adelie -0.21105   0.103178 -2.0455 0.04080661 -0.413276 -0.008824       43.92193               180  Gentoo</span></span>
<span><span class="co">#&gt;            species    Gentoo - Adelie  0.15912   0.303473  0.5243 0.60004695 -0.435676  0.753918       43.92193               180  Adelie</span></span>
<span><span class="co">#&gt;            species    Gentoo - Adelie  0.15912   0.303473  0.5243 0.60004695 -0.435676  0.753918       43.92193               180  Gentoo</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, type, term, contrast, estimate, std.error, statistic, p.value, conf.low, conf.high, predicted, predicted_hi, predicted_lo, large_penguin, bill_length_mm, flipper_length_mm, species, eps</span></span></code></pre></div>
<p>When variables are omitted from the <code>datagrid</code> call, they
will automatically be set at their mean or mode (depending on variable
type).</p>
</div>
<div class="section level2">
<h2 id="marginal-effect-at-the-mean-mem">Marginal Effect at the Mean (MEM)<a class="anchor" aria-label="anchor" href="#marginal-effect-at-the-mean-mem"></a>
</h2>
<p>The “Marginal Effect at the Mean” is a marginal effect calculated for
a hypothetical observation where each regressor is set at its mean or
mode. By default, the <code>datagrid</code> function that we used in the
previous section sets all regressors to their means or modes. To
calculate the MEM, we can set the <code>newdata</code> argument, which
determines the values of predictors at which we want to compute marginal
effects:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/slopes.html">slopes</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;               Term           Contrast Estimate Std. Error        z   Pr(&gt;|z|)     2.5 %   97.5 %</span></span>
<span><span class="co">#&gt;     bill_length_mm              dY/dX  0.05024    0.01199   4.1910  2.777e-05  0.026744  0.07373</span></span>
<span><span class="co">#&gt;  flipper_length_mm              dY/dX  0.01928    0.00556   3.4682 0.00052398  0.008386  0.03018</span></span>
<span><span class="co">#&gt;            species Chinstrap - Adelie -0.80704    0.07330 -11.0107 &lt; 2.22e-16 -0.950693 -0.66338</span></span>
<span><span class="co">#&gt;            species    Gentoo - Adelie  0.08286    0.11354   0.7297 0.46554593 -0.139685  0.30540</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, type, term, contrast, estimate, std.error, statistic, p.value, conf.low, conf.high, predicted, predicted_hi, predicted_lo, large_penguin, bill_length_mm, flipper_length_mm, species, eps</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="counterfactual-marginal-effects">Counterfactual Marginal Effects<a class="anchor" aria-label="anchor" href="#counterfactual-marginal-effects"></a>
</h2>
<p>The <code>datagrid</code> function allowed us look at completely
fictional individuals. Setting the <code>grid_type</code> argument of
this function to <code>"counterfactual"</code> lets us compute the
marginal effects for the actual observations in our dataset, but with a
few manipulated values. For example, this code will create a
<code>data.frame</code> twice as long as the original <code>dat</code>,
where each observation is repeated with different values of the
<code>flipper_length_mm</code> variable:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>flipper_length_mm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">160</span>, <span class="fl">180</span><span class="op">)</span>,</span>
<span>               model <span class="op">=</span> <span class="va">mod</span>,</span>
<span>               grid_type <span class="op">=</span> <span class="st">"counterfactual"</span><span class="op">)</span></span></code></pre></div>
<p>We see that the rows 1, 2, and 3 of the original dataset have been
replicated twice, with different values of the
<code>flipper_length_mm</code> variable:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nd</span><span class="op">[</span><span class="va">nd</span><span class="op">$</span><span class="va">rowid</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;     rowidcf large_penguin bill_length_mm species flipper_length_mm</span></span>
<span><span class="co">#&gt; 1         1             0           39.1  Adelie               160</span></span>
<span><span class="co">#&gt; 2         2             0           39.5  Adelie               160</span></span>
<span><span class="co">#&gt; 3         3             0           40.3  Adelie               160</span></span>
<span><span class="co">#&gt; 343       1             0           39.1  Adelie               180</span></span>
<span><span class="co">#&gt; 344       2             0           39.5  Adelie               180</span></span>
<span><span class="co">#&gt; 345       3             0           40.3  Adelie               180</span></span></code></pre></div>
<p>We can use the observation-level marginal effects to compute average
(or median, or anything else) marginal effects over the counterfactual
individuals:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/slopes.html">slopes</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="va">nd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">term</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#&gt;   term               estimate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> bill_length_mm    0.009<span style="text-decoration: underline;">85</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> flipper_length_mm 0.003<span style="text-decoration: underline;">78</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> species           0.000<span style="text-decoration: underline;">022</span>6</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="conditional-marginal-effects-plot">Conditional Marginal Effects (Plot)<a class="anchor" aria-label="anchor" href="#conditional-marginal-effects-plot"></a>
</h2>
<p>The <code>plot_slopes</code> function can be used to draw
“Conditional Marginal Effects.” This is useful when a model includes
interaction terms and we want to plot how the marginal effect of a
variable changes as the value of a “condition” (or “moderator”) variable
changes:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">hp</span> <span class="op">*</span> <span class="va">wt</span> <span class="op">+</span> <span class="va">drat</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_slopes.html">plot_slopes</a></span><span class="op">(</span><span class="va">mod</span>, variables <span class="op">=</span> <span class="st">"hp"</span>, condition <span class="op">=</span> <span class="st">"wt"</span><span class="op">)</span></span></code></pre></div>
<p><img src="slopes_files/figure-html/unnamed-chunk-17-1.png" width="60%"></p>
<p>The marginal effects in the plot above were computed with values of
all regressors – except the <code>variables</code> and the
<code>condition</code> – held at their means or modes, depending on
variable type.</p>
<p>Since <code><a href="../reference/plot_slopes.html">plot_slopes()</a></code> produces a <code>ggplot2</code>
object, it is easy to customize. For example:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_slopes.html">plot_slopes</a></span><span class="op">(</span><span class="va">mod</span>, variables <span class="op">=</span> <span class="st">"hp"</span>, condition <span class="op">=</span> <span class="st">"wt"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html" class="external-link">geom_rug</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">wt</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="slopes_files/figure-html/unnamed-chunk-18-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="example-quadratic">Example: Quadratic<a class="anchor" aria-label="anchor" href="#example-quadratic"></a>
</h2>
<p>In the “Definition” section of this vignette, we considered how
marginal effects can be computed analytically in a simple quadratic
equation context. We can now use the <code>slopes</code> function to
replicate our analysis of the quadratic function in a regression
application.</p>
<p>Say you estimate a linear regression model with a quadratic term:</p>
<p><span class="math display">\[Y = \beta_0 + \beta_1 X^2 +
\varepsilon\]</span></p>
<p>and obtain estimates of <span class="math inline">\(\beta_0=1\)</span> and <span class="math inline">\(\beta_1=2\)</span>. Taking the partial derivative
with respect to <span class="math inline">\(X\)</span> and plugging in
our estimates gives us the marginal effect of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span>:</p>
<p><span class="math display">\[\partial Y / \partial X = \beta_0 + 2
\cdot \beta_1 X\]</span> <span class="math display">\[\partial Y /
\partial X = 1 + 4X\]</span></p>
<p>This result suggests that the effect of a <em>change</em> in <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span> depends on the <em>level</em> of <span class="math inline">\(X\)</span>. When <span class="math inline">\(X\)</span> is large and positive, an increase in
<span class="math inline">\(X\)</span> is associated to a large increase
in <span class="math inline">\(Y\)</span>. When <span class="math inline">\(X\)</span> is small and positive, an increase in
<span class="math inline">\(X\)</span> is associated to a small increase
in <span class="math inline">\(Y\)</span>. When <span class="math inline">\(X\)</span> is a large negative value, an increase
in <span class="math inline">\(X\)</span> is associated with a
<em>decrease</em> in <span class="math inline">\(Y\)</span>.</p>
<p><code>marginaleffects</code> arrives at the same conclusion in
simulated data:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">1e5</span></span>
<span><span class="va">quad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">quad</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">+</span> <span class="fl">1</span> <span class="op">*</span> <span class="va">quad</span><span class="op">$</span><span class="va">x</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">quad</span><span class="op">$</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, <span class="va">quad</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/slopes.html">slopes</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">-</span><span class="fl">2</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>  <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>truth <span class="op">=</span> <span class="fl">1</span> <span class="op">+</span> <span class="fl">4</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">estimate</span>, <span class="va">truth</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate</span></span>
<span><span class="co">#&gt;    -6.998</span></span>
<span><span class="co">#&gt;    -3.000</span></span>
<span><span class="co">#&gt;     0.998</span></span>
<span><span class="co">#&gt;     4.996</span></span>
<span><span class="co">#&gt;     8.994</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  </span></span>
<span><span class="co">#&gt; Columns: estimate, truth</span></span></code></pre></div>
<p>We can plot conditional adjusted predictions with
<code>plot_predictions</code> function:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_predictions.html">plot_predictions</a></span><span class="op">(</span><span class="va">mod</span>, condition <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span></span></code></pre></div>
<p><img src="slopes_files/figure-html/unnamed-chunk-20-1.png" width="576"></p>
<p>We can plot conditional marginal effects with the
<code>plot_slopes</code> function (see section below):</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_slopes.html">plot_slopes</a></span><span class="op">(</span><span class="va">mod</span>, variables <span class="op">=</span> <span class="st">"x"</span>, condition <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span></span></code></pre></div>
<p><img src="slopes_files/figure-html/unnamed-chunk-21-1.png" width="576"></p>
<p>Again, the conclusion is the same. When <span class="math inline">\(x&lt;0\)</span>, an increase in <span class="math inline">\(x\)</span> is associated with an increase in <span class="math inline">\(y\)</span>. When <span class="math inline">\(x=0\)</span>, the marginal effect is equal to 0.
When <span class="math inline">\(x&gt;0\)</span>, an increase in <span class="math inline">\(x\)</span> is associated with a decrease in <span class="math inline">\(y\)</span>.</p>
</div>
<div class="section level2">
<h2 id="slopes-vs-predictions-a-visual-interpretation">Slopes vs Predictions: A Visual Interpretation<a class="anchor" aria-label="anchor" href="#slopes-vs-predictions-a-visual-interpretation"></a>
</h2>
<p>Often, analysts will plot predicted values of the outcome with a best
fit line:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">hp</span> <span class="op">*</span> <span class="va">qsec</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_predictions.html">plot_predictions</a></span><span class="op">(</span><span class="va">mod</span>, condition <span class="op">=</span> <span class="st">"hp"</span>, vcov <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mtcars</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">hp</span>, <span class="va">mpg</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p><img src="slopes_files/figure-html/unnamed-chunk-22-1.png" width="576"></p>
<p>The slope of this line is calculated using the same technique we all
learned in grade school: dividing rise over run.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_predictions.html">plot_predictions</a></span><span class="op">(</span><span class="va">mod</span>, condition <span class="op">=</span> <span class="st">"hp"</span>, vcov <span class="op">=</span> <span class="cn">TRUE</span>, draw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_predictions.html">plot_predictions</a></span><span class="op">(</span><span class="va">mod</span>, condition <span class="op">=</span> <span class="st">"hp"</span>, vcov <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">hp</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span>, xend <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">hp</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span>, yend <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">hp</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span>, xend <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">hp</span><span class="op">[</span><span class="fl">20</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="fl">20</span><span class="op">]</span>, yend <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, label <span class="op">=</span> <span class="st">"Rise"</span>, y <span class="op">=</span> <span class="fl">10</span>, x <span class="op">=</span> <span class="fl">140</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, label <span class="op">=</span> <span class="st">"Run"</span>, y <span class="op">=</span> <span class="fl">2</span>, x <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span></code></pre></div>
<p><img src="slopes_files/figure-html/unnamed-chunk-23-1.png" width="576"></p>
<p>Instead of computing this slope manually, we can just call:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/slopes.html">avg_slopes</a></span><span class="op">(</span><span class="va">mod</span>, variables <span class="op">=</span> <span class="st">"hp"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Term Estimate Std. Error      z   Pr(&gt;|z|)   2.5 %   97.5 %</span></span>
<span><span class="co">#&gt;    hp   -0.112    0.01255 -8.924 &lt; 2.22e-16 -0.1366 -0.08742</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: type, term, estimate, std.error, statistic, p.value, conf.low, conf.high</span></span></code></pre></div>
<p>Now, consider the fact that our model includes an interaction between
<code>hp</code> and <code>qsec</code>. This means that the slope will
actually differ based on the value of the moderator variable
<code>qsec</code>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_predictions.html">plot_predictions</a></span><span class="op">(</span><span class="va">mod</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"hp"</span>, <span class="st">"qsec"</span> <span class="op">=</span> <span class="st">"quartile"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="slopes_files/figure-html/unnamed-chunk-25-1.png" width="576"></p>
<p>We can estimate the slopes of these three fit lines easily:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/slopes.html">slopes</a></span><span class="op">(</span></span>
<span>  <span class="va">mod</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"hp"</span>,</span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>qsec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">qsec</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.25</span>, <span class="fl">.5</span>, <span class="fl">.75</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Term Estimate Std. Error      z   Pr(&gt;|z|)   2.5 %   97.5 %       hp    qsec</span></span>
<span><span class="co">#&gt;    hp -0.09338    0.01108 -8.428 &lt; 2.22e-16 -0.1151 -0.07167 146.6875 16.8925</span></span>
<span><span class="co">#&gt;    hp -0.10932    0.01226 -8.917 &lt; 2.22e-16 -0.1333 -0.08529 146.6875 17.7100</span></span>
<span><span class="co">#&gt;    hp -0.13251    0.01540 -8.604 &lt; 2.22e-16 -0.1627 -0.10233 146.6875 18.9000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: rowid, type, term, estimate, std.error, statistic, p.value, conf.low, conf.high, predicted, predicted_hi, predicted_lo, mpg, hp, qsec, eps</span></span></code></pre></div>
<p>As we see in the graph, all three slopes are negative, but the Q3
slope is steepest.</p>
<p>We could then push this one step further, and measure the slope of
<code>mpg</code> with respect to <code>hp</code>, <em>for all observed
values</em> of <code>qsec</code>. This is achieved with the
<code><a href="../reference/plot_slopes.html">plot_slopes()</a></code> function:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_slopes.html">plot_slopes</a></span><span class="op">(</span><span class="va">mod</span>, variables <span class="op">=</span> <span class="st">"hp"</span>, condition <span class="op">=</span> <span class="st">"qsec"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="slopes_files/figure-html/unnamed-chunk-27-1.png" width="576"></p>
<p>This plot shows that the marginal effect of <code>hp</code> on
<code>mpg</code> is always negative (the slope is always below zero),
and that this effect becomes even more negative as <code>qsec</code>
increases.</p>
</div>
<div class="section level2">
<h2 id="prediction-types">Prediction types<a class="anchor" aria-label="anchor" href="#prediction-types"></a>
</h2>
<p>The <code>marginaleffect</code> function takes the derivative of the
fitted (or predicted) values of the model, as is typically generated by
the <code>predict(model)</code> function. By default,
<code>predict</code> produces predictions on the <code>"response"</code>
scale, so the marginal effects should be interpreted on that scale.
However, users can pass a string or a vector of strings to the
<code>type</code> argument, and <code>marginaleffects</code> will
consider different outcomes.</p>
<p>Typical values include <code>"response"</code> and
<code>"link"</code>, but users should refer to the documentation of the
<code>predict</code> of the package they used to fit the model to know
what values are allowable. documentation.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">am</span> <span class="op">~</span> <span class="va">mpg</span>, family <span class="op">=</span> <span class="va">binomial</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/slopes.html">avg_slopes</a></span><span class="op">(</span><span class="va">mod</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Term Estimate Std. Error     z   Pr(&gt;|z|)   2.5 %  97.5 %</span></span>
<span><span class="co">#&gt;   mpg  0.04649   0.008857 5.249 1.5303e-07 0.02913 0.06385</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  response </span></span>
<span><span class="co">#&gt; Columns: type, term, estimate, std.error, statistic, p.value, conf.low, conf.high</span></span>
<span></span>
<span><span class="fu"><a href="../reference/slopes.html">avg_slopes</a></span><span class="op">(</span><span class="va">mod</span>, type <span class="op">=</span> <span class="st">"link"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Term Estimate Std. Error     z  Pr(&gt;|z|)   2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;   mpg    0.307     0.1148 2.673 0.0075066 0.08194 0.5321</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Prediction type:  link </span></span>
<span><span class="co">#&gt; Columns: type, term, estimate, std.error, statistic, p.value, conf.low, conf.high</span></span></code></pre></div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Vincent Arel-Bundock.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
